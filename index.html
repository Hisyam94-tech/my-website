<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electronics Repair Order System</title>
    <link rel="icon" type="image/png" href="CIRCUITCARE_new_logo-removebg.png">
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide Icons as inline SVGs
        const Search = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
        );

        const Plus = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Edit2 = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
            </svg>
        );

        const Trash2 = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
        );

        const X = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        const ChevronLeft = () => (
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
        );

        const ChevronRight = () => (
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        );

        const Image = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21 15 16 10 5 21"></polyline>
            </svg>
        );

        const Phone = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
            </svg>
        );

        const Mail = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
            </svg>
        );

        const Calendar = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        const DollarSign = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="1" x2="12" y2="23"></line>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
        );

        const FileText = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
        );

        function RepairOrderSystem() {
            const [orders, setOrders] = useState([]);
            const [filteredOrders, setFilteredOrders] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [filterStatus, setFilterStatus] = useState('all');
            const [showForm, setShowForm] = useState(false);
            const [editingOrder, setEditingOrder] = useState(null);
            const [expandedOrderId, setExpandedOrderId] = useState(null);
            const [imageGallery, setImageGallery] = useState({ isOpen: false, images: [], currentIndex: 0 });
            const [showInvoice, setShowInvoice] = useState(false);
            const [invoiceOrder, setInvoiceOrder] = useState(null);
            const [formData, setFormData] = useState({
                customerName: '',
                phone: '',
                email: '',
                device: '',
                issue: '',
                estimatedCost: '',
                status: 'pending',
                dateReceived: new Date().toISOString().split('T')[0],
                endDate: '',
                images: [],
                componentsChanged: []
            });

            useEffect(() => {
                const savedOrders = localStorage.getItem('repairOrders');
                if (savedOrders) {
                    setOrders(JSON.parse(savedOrders));
                }
            }, []);

            useEffect(() => {
                localStorage.setItem('repairOrders', JSON.stringify(orders));
                filterOrders();
            }, [orders, searchTerm, filterStatus]);

            const filterOrders = () => {
                let filtered = orders;

                if (filterStatus !== 'all') {
                    filtered = filtered.filter(order => order.status === filterStatus);
                }

                if (searchTerm) {
                    filtered = filtered.filter(order =>
                        order.customerName.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        order.device.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        order.orderNumber.toLowerCase().includes(searchTerm.toLowerCase())
                    );
                }

                setFilteredOrders(filtered);
            };

            const generateOrderNumber = () => {
                if (orders.length === 0) {
                    return 'CC00001';
                }
                
                const numbers = orders.map(order => {
                    const match = order.orderNumber.match(/CC(\d+)/);
                    return match ? parseInt(match[1]) : 0;
                });
                
                const maxNumber = Math.max(...numbers);
                const nextNumber = maxNumber + 1;
                return `CC${String(nextNumber).padStart(5, '0')}`;
            };

            const handleSubmit = () => {
                if (!formData.customerName || !formData.phone || !formData.device || !formData.issue) {
                    alert('Please fill in all required fields');
                    return;
                }
                
                if (editingOrder) {
                    setOrders(orders.map(order => 
                        order.id === editingOrder.id ? { ...formData, id: editingOrder.id, orderNumber: editingOrder.orderNumber } : order
                    ));
                } else {
                    const newOrder = {
                        ...formData,
                        id: Date.now(),
                        orderNumber: generateOrderNumber()
                    };
                    setOrders([...orders, newOrder]);
                }

                resetForm();
            };

            const resetForm = () => {
                setFormData({
                    customerName: '',
                    phone: '',
                    email: '',
                    device: '',
                    issue: '',
                    estimatedCost: '',
                    status: 'pending',
                    dateReceived: new Date().toISOString().split('T')[0],
                    endDate: '',
                    images: [],
                    componentsChanged: []
                });
                setShowForm(false);
                setEditingOrder(null);
            };

            const handleImageUpload = (e) => {
                const files = Array.from(e.target.files);
                const imagePromises = files.map(file => {
                    return new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onloadend = () => resolve(reader.result);
                        reader.readAsDataURL(file);
                    });
                });

                Promise.all(imagePromises).then(images => {
                    setFormData({...formData, images: [...formData.images, ...images]});
                });
            };

            const removeImage = (index) => {
                const newImages = formData.images.filter((_, i) => i !== index);
                setFormData({...formData, images: newImages});
            };

            const addComponent = () => {
                const newComponent = { id: Date.now(), name: '', cost: '' };
                setFormData({...formData, componentsChanged: [...formData.componentsChanged, newComponent]});
            };

            const updateComponent = (id, field, value) => {
                const updated = formData.componentsChanged.map(comp =>
                    comp.id === id ? {...comp, [field]: value} : comp
                );
                setFormData({...formData, componentsChanged: updated});
            };

            const removeComponent = (id) => {
                const filtered = formData.componentsChanged.filter(comp => comp.id !== id);
                setFormData({...formData, componentsChanged: filtered});
            };

            const handleEdit = (order) => {
                setEditingOrder(order);
                setFormData({
                    ...order,
                    componentsChanged: order.componentsChanged || []
                });
                setShowForm(true);
            };

            const handleDelete = (id) => {
                if (confirm('Are you sure you want to delete this order?')) {
                    setOrders(orders.filter(order => order.id !== id));
                }
            };

            const openImageGallery = (images, index) => {
                setImageGallery({ isOpen: true, images, currentIndex: index });
            };

            const closeImageGallery = () => {
                setImageGallery({ isOpen: false, images: [], currentIndex: 0 });
            };

            const nextImage = () => {
                setImageGallery(prev => ({
                    ...prev,
                    currentIndex: (prev.currentIndex + 1) % prev.images.length
                }));
            };

            const prevImage = () => {
                setImageGallery(prev => ({
                    ...prev,
                    currentIndex: prev.currentIndex === 0 ? prev.images.length - 1 : prev.currentIndex - 1
                }));
            };

            const generateInvoice = (order) => {
                setInvoiceOrder(order);
                setShowInvoice(true);
            };

            const printInvoice = () => {
                // Set document title for filename
                const originalTitle = document.title;
                document.title = `${invoiceOrder.customerName}_${invoiceOrder.orderNumber}`;
                
                window.print();
                
                // Restore original title after print
                setTimeout(() => {
                    document.title = originalTitle;
                }, 100);
            };

            const getStatusColor = (status) => {
                const colors = {
                    pending: 'bg-yellow-100 text-yellow-800',
                    'in-progress': 'bg-blue-100 text-blue-800',
                    completed: 'bg-green-100 text-green-800',
                    'Pending-Payment': 'bg-purple-100 text-purple-800',
                    cancelled: 'bg-red-100 text-red-800'
                };
                return colors[status] || 'bg-gray-100 text-gray-800';
            };

            const getStatusLabel = (status) => {
                const labels = {
                    pending: 'Pending',
                    'in-progress': 'In Progress',
                    completed: 'Completed',
                    'ready-pickup': 'Pending Payment',
                    cancelled: 'Cancelled'
                };
                return labels[status] || status;
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                    <style>
                        {`
                            @media print {
                                body * {
                                    visibility: hidden;
                                }
                                #invoice-print, #invoice-print * {
                                    visibility: visible;
                                }
                                #invoice-print {
                                    position: absolute;
                                    left: 0;
                                    top: 0;
                                    width: 100%;
                                }
                                .print\\:hidden {
                                    display: none !important;
                                }
                                @page {
                                    size: A4;
                                    margin: 0;
                                }
                                body {
                                    margin: 0;
                                    padding: 0;
                                }
                                #invoice-print {
                                    font-size: 11px !important;
                                    padding: 15mm !important;
                                    margin: 0 !important;
                                }
                                #invoice-print .border-2 {
                                    padding: 15px !important;
                                }
                                #invoice-print h1 {
                                    font-size: 28px !important;
                                    margin-bottom: 5px !important;
                                }
                                #invoice-print h2 {
                                    font-size: 20px !important;
                                    padding: 8px 0 !important;
                                    margin-bottom: 10px !important;
                                }
                                #invoice-print h3 {
                                    font-size: 14px !important;
                                    margin-bottom: 8px !important;
                                    padding-bottom: 5px !important;
                                }
                                #invoice-print .text-center.mb-8 {
                                    margin-bottom: 15px !important;
                                }
                                #invoice-print .grid.gap-8 {
                                    gap: 15px !important;
                                    margin-bottom: 15px !important;
                                }
                                #invoice-print .mb-8 {
                                    margin-bottom: 12px !important;
                                }
                                #invoice-print .space-y-2 > * + * {
                                    margin-top: 5px !important;
                                }
                                #invoice-print table {
                                    font-size: 11px !important;
                                }
                                #invoice-print .p-3 {
                                    padding: 6px !important;
                                }
                                #invoice-print img {
                                    max-height: 60px !important;
                                }
                                #invoice-print .grid-cols-4 {
                                    gap: 8px !important;
                                }
                                #invoice-print .mt-12 {
                                    margin-top: 15px !important;
                                }
                                #invoice-print .pt-8 {
                                    padding-top: 10px !important;
                                }
                                #invoice-print .pt-6 {
                                    padding-top: 10px !important;
                                }
                            }
                        `}
                    </style>
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-gradient-to-r from-blue-50 via-white to-blue-50 rounded-lg shadow-lg p-6 mb-6 border-2 border-blue-200">
                            <div className="flex items-center justify-center gap-4">
                                <img src="CIRCUITCARE_new_logo-removebg.png" alt="CircuitCare Logo" className="h-32 w-32 object-contain" />
                                <div className="text-center">
                                    <h1 className="text-3xl font-bold text-gray-800 mb-2">CircuitCare Monitor System</h1>
                                    <p className="text-gray-600">Track and manage all your repair orders</p>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <div className="flex flex-col md:flex-row gap-4">
                                <div className="flex-1 relative">
                                    <div className="absolute left-3 top-3 text-gray-400">
                                        <Search />
                                    </div>
                                    <input
                                        type="text"
                                        placeholder="Search by customer name, device, or order number..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    />
                                </div>
                                <select
                                    value={filterStatus}
                                    onChange={(e) => setFilterStatus(e.target.value)}
                                    className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                >
                                    <option value="all">All Status</option>
                                    <option value="pending">Pending</option>
                                    <option value="in-progress">In Progress</option>
                                    <option value="completed">Completed</option>
                                    <option value="Pending-Payment">Pending Payment</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                                <button
                                    onClick={() => setShowForm(true)}
                                    className="flex items-center gap-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                                >
                                    <Plus />
                                    New Order
                                </button>
                            </div>
                        </div>

                        {showForm && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-lg shadow-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                                    <h2 className="text-2xl font-bold mb-4">
                                        {editingOrder ? 'Edit Order' : 'New Repair Order'}
                                    </h2>
                                    <div className="space-y-4">
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                                    Customer Name *
                                                </label>
                                                <input
                                                    type="text"
                                                    value={formData.customerName}
                                                    onChange={(e) => setFormData({...formData, customerName: e.target.value})}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                                    Phone Number *
                                                </label>
                                                <input
                                                    type="tel"
                                                    value={formData.phone}
                                                    onChange={(e) => setFormData({...formData, phone: e.target.value})}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                                    Email
                                                </label>
                                                <input
                                                    type="email"
                                                    value={formData.email}
                                                    onChange={(e) => setFormData({...formData, email: e.target.value})}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                                    Device *
                                                </label>
                                                <input
                                                    type="text"
                                                    placeholder="e.g., iPhone 13, Samsung TV"
                                                    value={formData.device}
                                                    onChange={(e) => setFormData({...formData, device: e.target.value})}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                                    Total Cost (RM)
                                                </label>
                                                <input
                                                    type="number"
                                                    step="0.01"
                                                    value={formData.estimatedCost}
                                                    onChange={(e) => setFormData({...formData, estimatedCost: e.target.value})}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                                    Status
                                                </label>
                                                <select
                                                    value={formData.status}
                                                    onChange={(e) => setFormData({...formData, status: e.target.value})}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                >
                                                    <option value="pending">Pending</option>
                                                    <option value="in-progress">In Progress</option>
                                                    <option value="completed">Completed</option>
                                                    <option value="Pending-Payment">Pending Payment</option>
                                                    <option value="cancelled">Cancelled</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                                    Date Received
                                                </label>
                                                <input
                                                    type="date"
                                                    value={formData.dateReceived}
                                                    onChange={(e) => setFormData({...formData, dateReceived: e.target.value})}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                                    End Date
                                                </label>
                                                <input
                                                    type="date"
                                                    value={formData.endDate}
                                                    onChange={(e) => setFormData({...formData, endDate: e.target.value})}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                />
                                            </div>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Issue Description *
                                            </label>
                                            <textarea
                                                rows="3"
                                                value={formData.issue}
                                                onChange={(e) => setFormData({...formData, issue: e.target.value})}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                placeholder="Describe the problem..."
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Upload Images
                                            </label>
                                            <input
                                                type="file"
                                                accept="image/*"
                                                multiple
                                                onChange={handleImageUpload}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                            />
                                            {formData.images.length > 0 && (
                                                <div className="grid grid-cols-3 gap-2 mt-3">
                                                    {formData.images.map((img, index) => (
                                                        <div key={index} className="relative group">
                                                            <img 
                                                                src={img} 
                                                                alt={`Upload ${index + 1}`} 
                                                                className="w-full h-24 object-cover rounded-lg pointer-events-none"
                                                            />
                                                            <button
                                                                type="button"
                                                                onClick={(e) => {
                                                                    e.preventDefault();
                                                                    e.stopPropagation();
                                                                    removeImage(index);
                                                                }}
                                                                className="absolute top-1 right-1 bg-red-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity pointer-events-auto"
                                                            >
                                                                <X />
                                                            </button>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                        <div>
                                            <div className="flex justify-between items-center mb-2">
                                                <label className="block text-sm font-medium text-gray-700">
                                                    Components Changed
                                                </label>
                                                <button
                                                    type="button"
                                                    onClick={addComponent}
                                                    className="px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 transition-colors"
                                                >
                                                    + Add Component
                                                </button>
                                            </div>
                                            {formData.componentsChanged.length > 0 && (
                                                <div className="space-y-2">
                                                    {formData.componentsChanged.map((component) => (
                                                        <div key={component.id} className="flex gap-2 items-center">
                                                            <input
                                                                type="text"
                                                                placeholder="Component name (e.g., LCD Screen)"
                                                                value={component.name || ''}
                                                                onChange={(e) => updateComponent(component.id, 'name', e.target.value)}
                                                                className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                            />
                                                            <input
                                                                type="number"
                                                                step="0.01"
                                                                placeholder="Cost (RM)"
                                                                value={component.cost || ''}
                                                                onChange={(e) => updateComponent(component.id, 'cost', e.target.value)}
                                                                className="w-32 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                            />
                                                            <button
                                                                type="button"
                                                                onClick={() => removeComponent(component.id)}
                                                                className="p-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors"
                                                            >
                                                                <Trash2 />
                                                            </button>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                        <div className="flex gap-3 pt-4">
                                            <button
                                                onClick={handleSubmit}
                                                className="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors"
                                            >
                                                {editingOrder ? 'Update Order' : 'Create Order'}
                                            </button>
                                            <button
                                                onClick={resetForm}
                                                className="flex-1 bg-gray-200 text-gray-800 py-2 rounded-lg hover:bg-gray-300 transition-colors"
                                            >
                                                Cancel
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {imageGallery.isOpen && (
                            <div className="fixed inset-0 bg-black bg-opacity-95 flex items-center justify-center z-50">
                                <button
                                    onClick={closeImageGallery}
                                    className="absolute top-4 right-4 text-white hover:text-gray-300 transition-colors"
                                >
                                    <X />
                                </button>
                                
                                <button
                                    onClick={prevImage}
                                    className="absolute left-4 text-white hover:text-gray-300 transition-colors"
                                >
                                    <ChevronLeft />
                                </button>
                                
                                <div className="max-w-4xl max-h-[90vh] flex flex-col items-center">
                                    <img
                                        src={imageGallery.images[imageGallery.currentIndex]}
                                        alt={`Image ${imageGallery.currentIndex + 1}`}
                                        className="max-w-full max-h-[80vh] object-contain"
                                    />
                                    <p className="text-white mt-4 text-lg">
                                        {imageGallery.currentIndex + 1} / {imageGallery.images.length}
                                    </p>
                                </div>
                                
                                <button
                                    onClick={nextImage}
                                    className="absolute right-4 text-white hover:text-gray-300 transition-colors"
                                >
                                    <ChevronRight />
                                </button>
                            </div>
                        )}

                        {showInvoice && invoiceOrder && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto" onClick={() => setShowInvoice(false)}>
                                <div className="bg-white rounded-lg shadow-xl max-w-4xl w-full my-8 max-h-[95vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
                                    <div className="sticky top-0 bg-white p-6 border-b border-gray-200 flex justify-between items-center print:hidden z-10">
                                        <h2 className="text-2xl font-bold">Invoice Preview</h2>
                                        <div className="flex gap-2">
                                            <button
                                                onClick={printInvoice}
                                                className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                                            >
                                                Print Invoice
                                            </button>
                                            <button
                                                onClick={() => setShowInvoice(false)}
                                                className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-semibold"
                                            >
                                                âœ• Close
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div id="invoice-print" className="p-8">
                                        <div className="border-2 border-gray-300 p-8">
                                            <div className="text-center mb-8">
                                                <h1 className="text-4xl font-bold text-blue-600 mb-2">CircuitCare Enterprise</h1>
                                                <p className="text-gray-600">Electronics Repair Service</p>
                                                <div className="mt-2 text-sm text-gray-500">
                                                    <p>KULAI, 81000, INDAHPURA</p>
                                                    <p>Phone: +60 14-539 2245 | Email: circuitcare@gmail.com</p>
                                                </div>
                                            </div>

                                            <div className="border-t-2 border-b-2 border-gray-300 py-4 mb-6">
                                                <h2 className="text-2xl font-bold text-center">REPAIR INVOICE</h2>
                                            </div>

                                            <div className="grid grid-cols-2 gap-8 mb-8">
                                                <div>
                                                    <h3 className="font-bold text-lg mb-3 text-gray-800">Customer Information</h3>
                                                    <div className="space-y-2 text-sm">
                                                        <p><span className="font-semibold">Name:</span> {invoiceOrder.customerName}</p>
                                                        <p><span className="font-semibold">Phone:</span> {invoiceOrder.phone}</p>
                                                        {invoiceOrder.email && <p><span className="font-semibold">Email:</span> {invoiceOrder.email}</p>}
                                                    </div>
                                                </div>
                                                <div>
                                                    <h3 className="font-bold text-lg mb-3 text-gray-800">Order Details</h3>
                                                    <div className="space-y-2 text-sm">
                                                        <p><span className="font-semibold">Order Number:</span> {invoiceOrder.orderNumber}</p>
                                                        <p><span className="font-semibold">Date Received:</span> {invoiceOrder.dateReceived}</p>
                                                        {invoiceOrder.endDate && <p><span className="font-semibold">Date Completed:</span> {invoiceOrder.endDate}</p>}
                                                        <p><span className="font-semibold">Status:</span> <span className="inline-block px-2 py-1 rounded text-xs font-medium" style={{backgroundColor: getStatusColor(invoiceOrder.status).split(' ')[0].replace('bg-', ''), color: getStatusColor(invoiceOrder.status).split(' ')[1].replace('text-', '')}}>{getStatusLabel(invoiceOrder.status)}</span></p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div className="mb-8">
                                                <h3 className="font-bold text-lg mb-3 text-gray-800 border-b pb-2">Repair Details</h3>
                                                <table className="w-full">
                                                    <thead>
                                                        <tr className="bg-gray-100">
                                                            <th className="text-left p-3 font-semibold">Device</th>
                                                            <th className="text-left p-3 font-semibold">Issue Description</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td className="p-3 border-b">{invoiceOrder.device}</td>
                                                            <td className="p-3 border-b">{invoiceOrder.issue}</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            {/*}
                                            {invoiceOrder.images && invoiceOrder.images.length > 0 && (
                                                <div className="mb-8">
                                                    <h3 className="font-bold text-lg mb-3 text-gray-800 border-b pb-2">Device Images</h3>
                                                    <div className="grid grid-cols-4 gap-3">
                                                        {invoiceOrder.images.map((img, index) => (
                                                            <img 
                                                                key={index} 
                                                                src={img} 
                                                                alt={`Device ${index + 1}`} 
                                                                className="w-full h-32 object-cover rounded border"
                                                            />
                                                        ))}
                                                    </div>
                                                </div>
                                            )}
                                            */}
                                            {invoiceOrder.componentsChanged && invoiceOrder.componentsChanged.length > 0 && (
                                                <div className="mb-8">
                                                    <h3 className="font-bold text-lg mb-3 text-gray-800 border-b pb-2">Components Changed</h3>
                                                    <table className="w-full">
                                                        <thead>
                                                            <tr className="bg-gray-100">
                                                                <th className="text-left p-3 font-semibold">Component</th>
                                                                <th className="text-right p-3 font-semibold">Cost (RM)</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {invoiceOrder.componentsChanged.map((component, index) => (
                                                                <tr key={index}>
                                                                    <td className="p-3 border-b">{component.name}</td>
                                                                    <td className="p-3 border-b text-right">{parseFloat(component.cost).toFixed(2)}</td>
                                                                </tr>
                                                            ))}
                                                        </tbody>
                                                        <tfoot>
                                                            <tr className="bg-gray-50 font-semibold">
                                                                <td className="p-3">Subtotal (Components)</td>
                                                                <td className="p-3 text-right">
                                                                    {invoiceOrder.componentsChanged.reduce((sum, comp) => sum + parseFloat(comp.cost || 0), 0).toFixed(2)}
                                                                </td>
                                                            </tr>
                                                        </tfoot>
                                                    </table>
                                                </div>
                                            )}

                                            <div className="border-t-2 border-gray-300 pt-6">
                                                <div className="flex justify-end">
                                                    <div className="w-64">
                                                        <div className="flex justify-between mb-2 text-lg">
                                                            <span className="font-semibold">Total Cost:</span>
                                                            <span className="font-bold text-xl">RM {invoiceOrder.estimatedCost || '0.00'}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div className="mt-12 pt-8 border-t border-gray-300">
                                                <div className="text-center text-sm text-gray-600">
                                                    <p className="mb-2">Thank you for choosing CircuitCare!</p>
                                                    <p className="text-xs">This is a computer-generated invoice. Terms and conditions apply.</p>
                                                    <p className="text-xs mt-2">For inquiries, please contact us at info@circuitcare.com</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <h2 className="text-xl font-bold mb-4">
                                Orders ({filteredOrders.length})
                            </h2>
                            {filteredOrders.length === 0 ? (
                                <div className="text-center py-12 text-gray-500">
                                    <p className="text-lg">No orders found</p>
                                    <p className="text-sm mt-2">Create your first order to get started</p>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    {filteredOrders.map((order) => (
                                        <div key={order.id} className="border border-gray-500 rounded-lg overflow-hidden hover:shadow-md transition-shadow">
                                            <div 
                                                className="p-4 cursor-pointer bg-gray-300 hover:bg-blue-400"
                                                onClick={() => setExpandedOrderId(expandedOrderId === order.id ? null : order.id)}
                                            >
                                                <div className="flex items-center justify-between">
                                                    <div className="flex-1">
                                                        <h3 className="text-lg font-bold text-black-800">
                                                            Order #{order.orderNumber}
                                                        </h3>
                                                        <p className="text-gray-600">Device: {order.device}</p>
                                                    </div>
                                                    <span className={`px-3 py-1 rounded-full text-sm font-medium ${getStatusColor(order.status)}`}>
                                                        {getStatusLabel(order.status)}
                                                    </span>
                                                </div>
                                            </div>
                                            
                                            {expandedOrderId === order.id && (
                                                <div className="px-4 pb-4 border-t border-gray-200 bg-blue-100">
                                                    <div className="pt-4 space-y-3">
                                                        <div>
                                                            <p className="text-sm font-medium text-gray-700">Customer</p>
                                                            <p className="text-base text-gray-900">{order.customerName}</p>
                                                        </div>
                                                        
                                                        <div className="flex items-center gap-4 flex-wrap text-sm text-gray-600">
                                                            <div className="flex items-center gap-2">
                                                                <Phone />
                                                                {order.phone}
                                                            </div>
                                                            <div className="flex items-center gap-2">
                                                                <Calendar />
                                                                Start: {order.dateReceived}
                                                            </div>
                                                            {order.endDate && (
                                                                <div className="flex items-center gap-2">
                                                                    <Calendar />
                                                                    End: {order.endDate}
                                                                </div>
                                                            )}
                                                        </div>
                                                        
                                                        {order.email && (
                                                            <div className="flex items-center gap-2 text-sm text-gray-600">
                                                                <Mail />
                                                                {order.email}
                                                            </div>
                                                        )}
                                                        
                                                        {order.estimatedCost && (
                                                            <div className="flex items-center gap-2 text-sm text-gray-600">
                                                                <DollarSign />
                                                                RM {order.estimatedCost}
                                                            </div>
                                                        )}
                                                        
                                                        <div className="bg-white rounded p-3">
                                                            <p className="text-sm font-medium text-gray-700 mb-1">Issue Description</p>
                                                            <p className="text-sm text-gray-600">{order.issue}</p>
                                                        </div>

                                                        {order.componentsChanged && order.componentsChanged.length > 0 && (
                                                            <div className="bg-white rounded p-3">
                                                                <p className="text-sm font-medium text-gray-700 mb-2">Components Changed</p>
                                                                <div className="space-y-1">
                                                                    {order.componentsChanged.map((component, index) => (
                                                                        <div key={index} className="flex justify-between text-sm text-gray-600">
                                                                            <span>{component.name}</span>
                                                                            <span className="font-medium">RM {parseFloat(component.cost).toFixed(2)}</span>
                                                                        </div>
                                                                    ))}
                                                                </div>
                                                            </div>
                                                        )}
                                                        
                                                        {order.images && order.images.length > 0 && (
                                                            <div>
                                                                <p className="text-sm font-medium text-gray-700 mb-2">Images</p>
                                                                <div className="grid grid-cols-3 gap-2">
                                                                    {order.images.map((img, index) => (
                                                                        <img 
                                                                            key={index} 
                                                                            src={img} 
                                                                            alt={`Device ${index + 1}`} 
                                                                            className="w-full h-24 object-cover rounded-lg cursor-pointer hover:opacity-75 transition-opacity"
                                                                            onClick={(e) => {
                                                                                e.stopPropagation();
                                                                                openImageGallery(order.images, index);
                                                                            }}
                                                                        />
                                                                    ))}
                                                                </div>
                                                            </div>
                                                        )}
                                                        
                                                        <div className="flex gap-2 pt-2 flex-wrap">
                                                            <button
                                                                onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    generateInvoice(order);
                                                                }}
                                                                className="flex items-center gap-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                                                            >
                                                                <FileText />
                                                                Generate Invoice
                                                            </button>
                                                            <button
                                                                onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    handleEdit(order);
                                                                }}
                                                                className="flex items-center gap-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                                                            >
                                                                <Edit2 />
                                                                Edit
                                                            </button>
                                                            <button
                                                                onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    handleDelete(order.id);
                                                                }}
                                                                className="flex items-center gap-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
                                                            >
                                                                <Trash2 />
                                                                Delete
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<RepairOrderSystem />, document.getElementById('root'));
    </script>
</body>
</html>